## 認識Webhook

Python的開發環境最重要的就是要建立Webhook,讓LINE聊天的訊息能夠透過 Webhook 傳遞到用Python 編章的程式去做處理。Webhook 指的是一個「網址」,透過伺服器建立Webhook網址後,串接Webhook的位置就能使用HTTP的POST方法,向伺服器傳送或接收特定的資料。

當使用者在LINE聊天室裡跟LINE BOT聊天,會發生下列的步驟:
- Step 1 向使用 Message API 所建立的LINE BOT發送訊息。
- Step 2 訊息透過Webhook傳遞到使用者部署Python程式的伺服器。
- Step 3 根據Python程式的邏輯,處理訊息。
- Step 4 透過Webhook 回傳結果到 LINE BOT。
- Step 5 LINE BOT 發送訊息到LINE聊天室裡。

![upgit_20240625_1719249241.png](https://raw.githubusercontent.com/kcwc1029/obsidian-upgit-image/main/2024/06/upgit_20240625_1719249241.png)


## 取得 LINE Channel access token 和Channel secret

在 LINE Developer 控制台裡,進入自己建立的LINE Channel,前往 Basicsettings頁籤,能夠看到Channel secret(如果沒有看到或需要重新產生,點擊Issue就能產生)。

Channel secret：`6a9c1ffca393b5d4fd873fc3651d9b6a`

前往Messaging API 頁籤,就能找到Channel access token,它和 Channel secret 都是串接LINE Channel必須的金鑰(如果沒有看到或需要重新產生,點擊Reissue就能產生)。

Channel access token：`RBHXK6bnUll4n6JN60fg90MQYF6J975RxR+Lsdrn9RldjhdyJMTzjqdDU5jx4cIDBDpxZIZWwBeqv0jX/4fmsSYejcSNsL0ohRf4xlAmQCx0Eg031Cz9A43jXgWSkHSuWoTskkqLrOwWrFitwha7FQdB04t89/1O/w1cDnyilFU=`

## 註冊 ngrok 服務

在開發階段時,常常是使用本機的伺服器,無法真正在外界進行測試,然而透過免費的ngrok服務,能夠將本機環境對應到一個ngrok網址,公開在整個網際網路中,由於是公開網址,就能真正在外界進行測試。

ngrok 網站:https://ngrok.com

登入後,從左側選單點擊 Your Authtoken,會出現一段串接ngrok服務所使用的token(點擊網頁最下方reset token按鈕可以重設token)。

Authtoken：`246DSoi4JawuJlFB7A01IdIA0z4_3dEpCKGsBVVeXxnYen3dd`

先將Flask跟ngrok架設起來(確定使ˇ用127.0.0.1:5000跟ngrok的網址都可以使用)

```
from flask import Flask

app = Flask(__name__)

@app.route("/<name>")
def home(name):
    return f"<h1>hello {name}</h1>"

app.run()
```

